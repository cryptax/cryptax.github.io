<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>pycoin - Hack.lu 2021 - Cryptax&#39;s hand bag</title><meta name="Description" content="Cryptax&#39;s hand bag"><meta property="og:title" content="pycoin - Hack.lu 2021" />
<meta property="og:description" content="Pycoin - Hack.lu 2021 This is what we know:
1 2 3 4 5 6 7  PYCOIN Sold: 92 times Type: rev Risk: Low Seller: tunn3l A friend gave me this and he says he can not reverse this... but this is just python?   and we get a .pyc file and a hint flag[5] == &quot;5&quot; .
I unfortunately did not solve this challenge on time for the CTF but found it interesting (I got stuck trying to disassemble with dis and did not know xdis did the work)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" /><meta property="og:image" content="https://cryptax.github.io/logo.png"/><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Cryptax" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cryptax.github.io/logo.png"/>

<meta name="twitter:title" content="pycoin - Hack.lu 2021"/>
<meta name="twitter:description" content="Pycoin - Hack.lu 2021 This is what we know:
1 2 3 4 5 6 7  PYCOIN Sold: 92 times Type: rev Risk: Low Seller: tunn3l A friend gave me this and he says he can not reverse this... but this is just python?   and we get a .pyc file and a hint flag[5] == &quot;5&quot; .
I unfortunately did not solve this challenge on time for the CTF but found it interesting (I got stuck trying to disassemble with dis and did not know xdis did the work)."/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" /><link rel="prev" href="https://cryptax.github.io/2020-12-07-shakticon/" /><link rel="next" href="https://cryptax.github.io/2023-04-22-nothingtohide/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "pycoin - Hack.lu 2021",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/cryptax.github.io\/2021-11-04-hacklu-pycoin\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/cryptax.github.io\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "Hack.lu, CTF, 2021, Python, Bytecode, Reverse","wordcount":  1695 ,
        "url": "https:\/\/cryptax.github.io\/2021-11-04-hacklu-pycoin\/","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/cryptax.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "cryptax"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Cryptax&#39;s hand bag"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span>LoveIt</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/categories/documentation/"> Docs </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Cryptax&#39;s hand bag"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span>LoveIt</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/categories/documentation/" title="">Docs</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">pycoin - Hack.lu 2021</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>cryptax</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1695 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;8 minutes&nbsp;<span id="/2021-11-04-hacklu-pycoin/" class="leancloud_visitors" data-flag-title="pycoin - Hack.lu 2021">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#uncompyle">Uncompyle</a></li>
    <li><a href="#marshal">Marshal</a></li>
    <li><a href="#disassembling-python-bytecode">Disassembling Python bytecode</a></li>
    <li><a href="#understanding-the-byte-code">Understanding the byte code</a></li>
    <li><a href="#solving-the-conditions-and-flag">Solving the conditions and flag</a></li>
    <li><a href="#full-source-code">Full source code</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="pycoin---hacklu-2021">Pycoin - Hack.lu 2021</h1>
<p>This is what we know:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">PYCOIN
Sold:  	92 times
Type:  	rev
Risk:  	Low
Seller:  	tunn3l

A friend gave me this and he says he can not reverse this... but this is just python? 
</code></pre></td></tr></table>
</div>
</div><p>and we get a <strong>.pyc file</strong> and a  hint <code>flag[5] == &quot;5&quot; </code>.</p>
<p>I unfortunately did not solve this challenge on time for the CTF but found it interesting (I got stuck trying to disassemble with <code>dis</code> and did not know <code>xdis</code> did the work).</p>
<p><strong>Thanks to tunn3l, TheBadGod, crabbers and crazyman for their help elaborating this write-up.</strong></p>
<h1 id="solution">Solution</h1>
<p>There is <a href="https://r3kapig.com/writeup/20211102-hacklu/#pycoin%28low%29" target="_blank" rel="noopener noreffer ">another write-up here</a>, but I didn&rsquo;t find it detailed enough to understand how to solve the challenge. Hopefully a better attempt below!</p>
<h2 id="uncompyle">Uncompyle</h2>
<p>I used <a href="https://pypi.org/project/uncompyle6/" target="_blank" rel="noopener noreffer ">uncompyle6</a> to transform the <code>.pyc</code> to <code>.py</code>: <code>uncompyle6 pycoin.pyc &gt; uncompiled.py</code>. The resulting source code is still obscure:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">marshal</span>
<span class="n">marshalled</span> <span class="o">=</span>  <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xe3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">.... &#39;</span>
<span class="n">exec</span><span class="p">(</span><span class="n">marshal</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">marshalled</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="marshal">Marshal</h2>
<p><a href="https://docs.python.org/3/library/marshal.html" target="_blank" rel="noopener noreffer ">Marshal</a> is an internal Python object serialization module.</p>
<p>If we have a look at the marshalled string, we see it is actually Python byte code from a file named <code>disassembly</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">redata</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">marshalled</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">redata</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">code</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x7efedf31e9d0</span><span class="p">,</span> <span class="n">file</span> <span class="s2">&#34;&lt;disassembly&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>By scanning the <code>marshalled</code> string more in details, we spot strings the program asks:</p>
<ul>
<li>please supply a valid key:</li>
<li>valid key!</li>
<li>invalid key :</li>
</ul>
<p>and obviously there is MD5 hashing involved (spot md5, digest etc):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">xda\x03md5z
\xda\x06digestZ\
...
</code></pre></td></tr></table>
</div>
</div><h2 id="disassembling-python-bytecode">Disassembling Python bytecode</h2>
<p>Unfortunately, the regular <code>dis</code> disassembler does not work:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">disassemble</span><span class="p">(</span><span class="n">redata</span><span class="p">)</span>
  <span class="mi">1</span>           <span class="mi">0</span> <span class="n">JUMP_FORWARD</span>             <span class="mi">2</span> <span class="p">(</span><span class="n">to</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;&lt;stdin&gt;&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s2">&#34;/usr/lib/python3.8/dis.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">369</span><span class="p">,</span> <span class="ow">in</span> <span class="n">disassemble</span>
    <span class="n">_disassemble_bytes</span><span class="p">(</span><span class="n">co</span><span class="o">.</span><span class="n">co_code</span><span class="p">,</span> <span class="n">lasti</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">co_names</span><span class="p">,</span>
  <span class="n">File</span> <span class="s2">&#34;/usr/lib/python3.8/dis.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">401</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_disassemble_bytes</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">_get_instructions_bytes</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span>
  <span class="n">File</span> <span class="s2">&#34;/usr/lib/python3.8/dis.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">340</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_get_instructions_bytes</span>
    <span class="n">argval</span><span class="p">,</span> <span class="n">argrepr</span> <span class="o">=</span> <span class="n">_get_name_info</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&#34;/usr/lib/python3.8/dis.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">304</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_get_name_info</span>
    <span class="n">argval</span> <span class="o">=</span> <span class="n">name_list</span><span class="p">[</span><span class="n">name_index</span><span class="p">]</span>
<span class="ne">IndexError</span><span class="p">:</span> <span class="nb">tuple</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span>
</code></pre></td></tr></table>
</div>
</div><p>The solution consists in using <a href="https://github.com/rocky/python-xdis/" target="_blank" rel="noopener noreffer ">xdis</a> which handles python bytecode from multiple versions.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">xdis.std</span> <span class="k">as</span> <span class="nn">dis</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">redata</span><span class="p">)</span>
  <span class="mi">1</span><span class="p">:</span>           <span class="mi">0</span> <span class="n">JUMP_FORWARD</span>         <span class="p">(</span><span class="n">to</span> <span class="mi">4</span><span class="p">)</span>
               <span class="mi">2</span> <span class="n">LOAD_GLOBAL</span>          <span class="p">(</span><span class="mi">99</span><span class="p">)</span>
         <span class="o">&gt;&gt;</span>    <span class="mi">4</span> <span class="n">LOAD_CONST</span>           <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
               <span class="mi">6</span> <span class="n">LOAD_CONST</span>           <span class="p">((</span><span class="s1">&#39;md5&#39;</span><span class="p">,))</span>
               <span class="mi">8</span> <span class="n">IMPORT_NAME</span>          <span class="p">(</span><span class="n">hashlib</span><span class="p">)</span>
              <span class="mi">10</span> <span class="n">IMPORT_FROM</span>          <span class="p">(</span><span class="n">md5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="understanding-the-byte-code">Understanding the byte code</h2>
<p>We read the byte code step by step to understand what the program does.
It reads the user input, and stores it in a variable named <code>k</code>. Precisely the following bytecode would correspond to <code>k = str(input('please supply a valid key:')).encode()</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">              14 POP_TOP
              16 LOAD_NAME            (str)
              18 LOAD_NAME            (input)
              20 LOAD_CONST           (&#39;please supply a valid key:&#39;)
              22 CALL_FUNCTION        1
              24 CALL_FUNCTION        1
              26 LOAD_METHOD          (encode)
 6:          28 CALL_METHOD          0
              30 STORE_NAME           (k)
</code></pre></td></tr></table>
</div>
</div><p>Check the input length (<code>k</code>) is 16:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"> 
              32 LOAD_NAME            (len)
              34 LOAD_NAME            (k)
              36 CALL_FUNCTION        1
              38 LOAD_CONST           (16)
              40 COMPARE_OP           (==)
</code></pre></td></tr></table>
</div>
</div><p>Check that <code>k[0] = 102</code>. This corresponds to character <code>f</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">            46 LOAD_NAME            (k)
              48 LOAD_CONST           (0)
              50 BINARY_SUBSCR

  6:          52 LOAD_CONST           (102)
              54 COMPARE_OP           (==)
</code></pre></td></tr></table>
</div>
</div><p>Each time, if the comparison fails, we will fail with invalid key:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">7:          42 EXTENDED_ARG         (256)
              44 JUMP_IF_FALSE_OR_POP (to 462)
</code></pre></td></tr></table>
</div>
</div><p>Check that <code>k[1] = k[0] + 6</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">           60 LOAD_NAME            (k)
              62 LOAD_CONST           (1)
              64 BINARY_SUBSCR
              66 LOAD_NAME            (k)
              68 LOAD_CONST           (0)
              70 BINARY_SUBSCR
              72 LOAD_CONST           (6)

  6:          74 BINARY_ADD
              76 COMPARE_OP           (==)
</code></pre></td></tr></table>
</div>
</div><p>As k[0] is <code>f</code>, we get k[1] = <code>l</code>. The format of Hack.Lu flags is <code>flag{....}</code>, so it makes sense.</p>
<p>The next bytecode checks that <code>k[2] = k[1] - k[0] + 91</code>. So, k[2]=&lsquo;a&rsquo;.
Then, k[3] = 103 = &lsquo;g&rsquo;.</p>
<p>The following bytecode checks that k[4] = k[11] * 3 - 42.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">            138 LOAD_NAME            (k)
             140 LOAD_CONST           (4)
             142 BINARY_SUBSCR

  6:         144 LOAD_NAME            (k)
             146 LOAD_CONST           (11)

 12:         148 BINARY_SUBSCR
             150 LOAD_CONST           (3)
             152 BINARY_MULTIPLY
             154 LOAD_CONST           (42)
             156 BINARY_SUBTRACT
             158 COMPARE_OP           (==)
</code></pre></td></tr></table>
</div>
</div><p>As we know that k[4]='{', this means k[11] = (k[4] + 42)/3 = &lsquo;7&rsquo;</p>
<p>The next check is: <code>k[5] = sum(k)-1322</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">            164 LOAD_NAME            (k)

  6:         166 LOAD_CONST           (5)
             168 BINARY_SUBSCR

 13:         170 LOAD_NAME            (sum)
             172 LOAD_NAME            (k)
             174 CALL_FUNCTION        1
             176 LOAD_CONST           (1322)
             178 BINARY_SUBTRACT
             180 COMPARE_OP           (==)

</code></pre></td></tr></table>
</div>
</div><p>The next check is <code>k[6]  + k[7] + k[10] == 260</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">           186 LOAD_NAME            (k)
           188 LOAD_CONST           (6)
           190 BINARY_SUBSCR
           192 LOAD_NAME            (k)
           194 LOAD_CONST           (7)

  6:         196 BINARY_SUBSCR
             198 BINARY_ADD

 14:         200 LOAD_NAME            (k)
             202 LOAD_CONST           (10)
             204 BINARY_SUBSCR
             206 BINARY_ADD
             208 LOAD_CONST           (260)
             210 COMPARE_OP           (==)
</code></pre></td></tr></table>
</div>
</div><p>Then, we have: <code>int(chr(k[7]) * 2) + 1 = k[9]</code>. In this formula, beware: <code>chr(k[7]) * 2</code> is the Python way to create a string of 2 characters <code>chr(k[7])</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">            216 LOAD_NAME            (int)
             218 LOAD_NAME            (chr)
             220 LOAD_NAME            (k)
             222 LOAD_CONST           (7)
             224 BINARY_SUBSCR
             226 CALL_FUNCTION        1
             228 LOAD_CONST           (2)

  6:         230 BINARY_MULTIPLY
             232 CALL_FUNCTION        1

 15:         234 LOAD_CONST           (1)
             236 BINARY_ADD
             238 LOAD_NAME            (k)
             240 LOAD_CONST           (9)
             242 BINARY_SUBSCR
             244 COMPARE_OP           (==)
</code></pre></td></tr></table>
</div>
</div><p>We won&rsquo;t detail the other checks, but there are:</p>
<ul>
<li>int(chr(k[7]) * 2) + 1 = k[9]</li>
<li>k[8] % 17 = 16</li>
<li>k[9] = k[8] * 2</li>
<li>md5(k[10] * b&rsquo;a').digest()[0] - 1 = k[3]</li>
<li>k[11] = 55</li>
<li>k[12] = k[14] / 2 - 2</li>
<li>k[13] = k[10] * k[8] % 32 * 2 - 1</li>
<li>k[14] = (k[12] ^ k[9] ^ k[15]) * 3 - 23</li>
<li>k[15] = 125 = &lsquo;}&rsquo;</li>
</ul>
<h2 id="solving-the-conditions-and-flag">Solving the conditions and flag</h2>
<p>First, we solve all conditions which directly provide characters.
This gives us <code>flag{....}</code> and <code>k[5]='5'</code> and <code>k[11]='7'</code>.</p>
<p>Then, we try to find possible values for k[8], knowing that <code>k[8] % 17 == 16</code>, and that k[9] depends on k[8] is probably an alphanumeric character. We are lucky, there is <strong>only one possible value for k[8]</strong>: &lsquo;2&rsquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">possible_k8</span><span class="p">():</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    computes possible values for k[8] which provide alphanumeric value for k[9]
</span><span class="s1">    given formulas:
</span><span class="s1">    k[8] % 17 == 16
</span><span class="s1">    and k[9] = k[8] * 2
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k8</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k8</span> <span class="o">%</span> <span class="mi">17</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">k9</span> <span class="o">=</span> <span class="n">k8</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">k9</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">):</span>
                <span class="n">possible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k8</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k8=</span><span class="si">{}</span><span class="s2"> k9=</span><span class="si">{}</span><span class="s2"> not possible&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k8</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="n">k9</span><span class="p">)))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">possible</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">possible</span>
</code></pre></td></tr></table>
</div>
</div><p>We immediately deduce k[9] = <code>d</code> from formula <code>k[9] = k[8] * 2</code>, and k[7] = <code>9</code> from <code>int(chr(k[7]) * 2) + 1 = k[9]</code>. In the last formula, note that the Python operation <code>chr(k[7])*2</code> returns <code>9</code>*2, i.e <code>99</code>.</p>
<p>Same, we try to guess possible values for k[10] knowing that <code>md5(k10 * b'a').digest()[0] - 1 = k[3]</code>. We already have k[3]. Assuming k[10] will be alphanumeric, we brute force each value and keep those that match the md5 formula. There is only 1 result. We get k[10] = &lsquo;e&rsquo;.  From k[10], we automatically compute k[13] and k[6].</p>
<p>Then, there are 2 remaining characters to find: k[12] and k[14] which depend on each other.
Assuming k[12] will be alphanumeric, we compute k[14] with <code>(k[12] ^ k[9] ^ k[15]) * 3 - 23</code> and keep possible values.</p>
<p>In the end, there is only one possible solution: <code>flag{5f92de703d}</code></p>
<h2 id="full-source-code">Full source code</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    Sets the known characters for the flag
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;flag{&#39;</span><span class="o">+</span><span class="s1">&#39;x&#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="s1">&#39;}&#39;</span><span class="p">)</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;5&#39;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;len=</span><span class="si">{}</span><span class="s1"> k=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">k</span>

<span class="k">def</span> <span class="nf">possible_k8</span><span class="p">():</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    computes possible values for k[8] which provide alphanumeric value for k[9]
</span><span class="s1">    given formulas:
</span><span class="s1">    k[8] % 17 == 16
</span><span class="s1">    and k[9] = k[8] * 2
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k8</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k8</span> <span class="o">%</span> <span class="mi">17</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">k9</span> <span class="o">=</span> <span class="n">k8</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">k9</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">):</span>
                <span class="n">possible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k8</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;Possible k8=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">possible</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">possible</span>

<span class="k">def</span> <span class="nf">possible_k10</span><span class="p">(</span><span class="n">k3</span><span class="p">):</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    computes possible values for k[10], knowing correct k[3]
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k10</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">computed_k3</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">k10</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">k3</span> <span class="o">==</span> <span class="n">computed_k3</span><span class="p">:</span>
            <span class="n">possible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k10</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;Possible k10=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">possible</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">possible</span>

<span class="k">def</span> <span class="nf">possible_k12</span><span class="p">(</span><span class="n">k9</span><span class="p">,</span> <span class="n">k15</span><span class="p">):</span>
    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    computes possible values for k[12], knowing correct k[9] and k[15]
</span><span class="s1">    which give alphanumeric result for k[14]
</span><span class="s1">    knowing formulas:
</span><span class="s1">    k[14] = (k[12] ^ k[9] ^ k[15]) * 3 - 23
</span><span class="s1">    k[12] = k[14] / 2 - 2
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k12</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">k14</span> <span class="o">=</span> <span class="p">(</span><span class="n">k12</span> <span class="o">^</span> <span class="n">k9</span> <span class="o">^</span> <span class="n">k15</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">23</span>
        <span class="k">if</span> <span class="n">k14</span> <span class="o">&gt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k14</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k14</span> <span class="o">==</span> <span class="p">(</span><span class="n">k12</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">possible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k12</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;Possible k12=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">possible</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">possible</span>
        
    

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">init</span><span class="p">()</span>
    
    <span class="n">possible</span> <span class="o">=</span> <span class="n">possible_k8</span><span class="p">()</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possible</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&#34;we have several possible k8&#34;</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k[8]=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>

    <span class="c1"># k[9] = k[8] * 2</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k[9]=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>

    <span class="c1"># int(chr(k[7]) * 2) + 1 = k[9]</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k[7]=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    
    <span class="n">possible</span> <span class="o">=</span> <span class="n">possible_k10</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possible</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&#34;we have several possible k10&#34;</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span> <span class="p">(((</span><span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="o">*</span> <span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span> <span class="o">%</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k[13]=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">13</span><span class="p">]))</span>

    <span class="c1">#k[6]  + k[7] + k[10]  = 260</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">260</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k[6]=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

    <span class="n">possible</span> <span class="o">=</span> <span class="n">possible_k12</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">9</span><span class="p">]),</span> <span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">15</span><span class="p">]))</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">possible</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&#34;we have several possible k12&#34;</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;k[14]=</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Solution: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2021-11-04-hacklu-pycoin/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" data-title="pycoin - Hack.lu 2021" data-via="@cryptax" data-hashtags="Hack.lu,CTF,2021,Python,Bytecode,Reverse"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" data-hashtag="Hack.lu"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" data-title="pycoin - Hack.lu 2021"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" data-title="pycoin - Hack.lu 2021"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://cryptax.github.io/2021-11-04-hacklu-pycoin/" data-title="pycoin - Hack.lu 2021"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/hack.lu/">hack.lu</a>,&nbsp;<a href="/tags/ctf/">CTF</a>,&nbsp;<a href="/tags/2021/">2021</a>,&nbsp;<a href="/tags/python/">Python</a>,&nbsp;<a href="/tags/bytecode/">Bytecode</a>,&nbsp;<a href="/tags/reverse/">Reverse</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2020-12-07-shakticon/" class="prev" rel="prev" title="Shakti CTF 2020"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Shakti CTF 2020</a>
            <a href="/2023-04-22-nothingtohide/" class="next" rel="next" title="Nothing to Hide (THCon CTF 2023)">Nothing to Hide (THCon CTF 2023)<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">cryptax</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"valine":{"appId":"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI","appKey":"WBmoGyJtbqUswvfLh6L8iEBr","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"en","pageSize":10,"placeholder":"Your comment ...","recordIP":true,"serverURLs":"https://leancloud.hugoloveit.com","visitor":true}},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.en","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
